#include <kapi/kapi.h>
#include <utils.h>
#include <string.h>


#define	SQ(X)	((X)*(X))
static const struct sqrtl_vector {
	unsigned long val;
	unsigned long res;
} vectors[] = {
	{ SQ(1),		1, },
	{ SQ(2),		2, },
	{ SQ(3),		3, },
	{ SQ(4),		4, },
	{ SQ(5),		5, },
	{ SQ(6),		6, },
	{ SQ(7),		7, },
	{ SQ(8),		8, },
	{ SQ(9),		9, },
	{ SQ(10),		10, },
	{ SQ(11),		11, },
	{ SQ(12),		12, },
	{ SQ(13),		13, },
	{ SQ(14),		14, },
	{ SQ(15),		15, },
	{ SQ(16),		16, },
	{ SQ((1<<5)-1),		(1<<5)-1, },
	{ SQ((1<<5)),		(1<<5), },
	{ SQ((1<<5)+1),		(1<<5)+1, },
	{ SQ((1<<6)-1),		(1<<6)-1, },
	{ SQ((1<<6)),		(1<<6), },
	{ SQ((1<<6)+1),		(1<<6)+1, },
	{ SQ((1<<7)-1),		(1<<7)-1, },
	{ SQ((1<<7)),		(1<<7), },
	{ SQ((1<<7)+1),		(1<<7)+1, },
	{ SQ((1<<8)-1),		(1<<8)-1, },
	{ SQ((1<<8)),		(1<<8), },
	{ SQ((1<<8)+1),		(1<<8)+1, },
	{ SQ((1<<9)-1),		(1<<9)-1, },
	{ SQ((1<<9)),		(1<<9), },
	{ SQ((1<<9)+1),		(1<<9)+1, },
	{ SQ((1<<10)-1),	(1<<10)-1, },
	{ SQ((1<<10)),		(1<<10), },
	{ SQ((1<<10)+1),	(1<<10)+1, },
	{ SQ((1<<11)-1),	(1<<11)-1, },
	{ SQ((1<<11)),		(1<<11), },
	{ SQ((1<<11)+1),	(1<<11)+1, },
	{ SQ((1<<12)-1),	(1<<12)-1, },
	{ SQ((1<<12)),		(1<<12), },
	{ SQ((1<<12)+1),	(1<<12)+1, },
	{ SQ((1<<13)-1),	(1<<13)-1, },
	{ SQ((1<<13)),		(1<<13), },
	{ SQ((1<<13)+1),	(1<<13)+1, },
	{ SQ((1<<14)-1),	(1<<14)-1, },
	{ SQ((1<<14)),		(1<<14), },
	{ SQ((1<<14)+1),	(1<<14)+1, },
	{ SQ((1<<15)-1),	(1<<15)-1, },
	{ SQ((1<<15)),		(1<<15), },
	{ SQ((1<<15)+1),	(1<<15)+1, },
	{ SQ(20-1),		20-1, },
	{ SQ(20),		20, },
	{ SQ(20+1),		20+1, },
	{ SQ(100-1),		100-1, },
	{ SQ(100),		100, },
	{ SQ(100+1),		100+1, },
	{ SQ(200-1),		200-1, },
	{ SQ(200),		200, },
	{ SQ(200+1),		200+1, },
	{ SQ(500-1),		500-1, },
	{ SQ(500),		500, },
	{ SQ(500+1),		500+1, },
	{ SQ(1000-1),		1000-1, },
	{ SQ(1000),		1000, },
	{ SQ(1000+1),		1000+1, },
	{ SQ(2000-1),		2000-1, },
	{ SQ(2000),		2000, },
	{ SQ(2000+1),		2000+1, },
	{ SQ(5000-1),		5000-1, },
	{ SQ(5000),		5000, },
	{ SQ(5000+1),		5000+1, },
	{ SQ(10000-1),		10000-1, },
	{ SQ(10000),		10000, },
	{ SQ(10000+1),		10000+1, },
	{ SQ(20000-1),		20000-1, },
	{ SQ(20000),		20000, },
	{ SQ(20000+1),		20000+1, },
	{ SQ(50000U-1),		50000-1, },
	{ SQ(50000U),		50000, },
	{ SQ(50000U+1),		50000+1, },
};

#include <math.h>
static int dotest(void)
{
	unsigned int ok = 0;
	unsigned int ko = 0;
	unsigned int i;

	for (i = 0; i < ARRAY_SIZE(vectors); i++) {
		const struct sqrtl_vector *v = &vectors[i];
		unsigned long r = sqrtl(v->val);
		if (r != v->res) {
			printf("#ERROR:\tsqrtl(%lu) should be %lu but is %lu\n", v->val, v->res, r);
			ko++;
		} else
			ok++;
	}

	printf("Tests fail: %u, succeed: %u\n", ko, ok);
	return ko;
}

void kapi_start(void)
{
	dotest();
}
